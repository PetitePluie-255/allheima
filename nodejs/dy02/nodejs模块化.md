# nodejs模块化

### **什么是模块化**

```
定义：commonjs 模块是为node.js打包javascript代码的原始方式.node.js还支持浏览器和其他javascript运行时使用的ECMAScript模块标准.在node.js中,每个文件都被视为一个单独的模块
概念: 项目是由很多个模块文件组成的
好处: 提高代码复用性,按需加载,独立作用域
使用: 需要标准语法导出和导入进行使用
```

### **CommonJS 标准**

```
使用:1.导出:module.exports={}
2.导入:require('模块名或路径')
```

### ECMAScript 标准 - 默认导出和导入

```
1.导出:export default{}
2.导入:import 变量名 from "模块名或路径"
注意：Node.js 默认支持 CommonJS 标准语法
```

### ECMAScript 标准 - 命名导出和导入

```
1. 导出：export 修饰定义语句
2. 导入：import { 同名变量 } from '模块名或路径‘
```

```
如何选择： 
按需加载，使用命名导出和导入 
全部加载，使用默认导出和导入
```

### 包的概念

```
包：将模块，代码，其他资料聚合成一个文件夹
包分类：
项目包：主要用于编写项目和业务逻辑
软件包：封装工具和方法进行使用
要求：根目录中，必须有 package.json 文件（记录包的清单信息）
注意：导入软件包时，引入的默认是 index.js 模块文件 / main 属性指定的模块文件
```

### npm - 软件包管理器

```
定义: npm 是Node.js 标准的软件包管理器
在 2017 年1月时，npm 仓库中就已有超过 350000 个软件包，这使其成为世界上最大的单一语言代码仓库，并且可以确定几乎有可用于一切的软件包。
它起初是作为下载和管理 Node.s 包依赖的方式，但其现在也已成为前端 JavaScript 中使用的工具
使用：
1. 初始化清单文件 ：npm init -y（得到 package.json 文件，有则略过此命令）
2. 下载软件包 ：npm i 软件包名称
3. 使用软件包
```

### npm - 安装所有依赖

```
问题：项目中不包含 node_modules，能否正常运行？
答案：不能，缺少依赖的本地软件包
原因：因为，自己用 npm 下载依赖比磁盘传递拷贝要快得多
解决：项目终端输入命令：npm i
下载 package.json 中记录的所有软件包
```

### npm - 全局软件包 nodemon

```
软件包区别：
本地软件包：当前项目内使用，封装属性和方法，存在于 node_modules
全局软件包：本机所有项目使用，封装命令和工具，存在于系统设置的位置
nodemon 作用：替代 node 命令，检测代码更改，自动重启程序
使用：
1. 安装：npm i nodemon -g（-g 代表安装到全局环境中）
2. 运行：nodemon 待执行的目标 js 文件
需求：启动准备好的项目，修改代码保存后，观察自动重启应用程序
```

```
常用命令：
执行 js 文件 node xxx
初始化 package.json npm init -y
下载本地软件包 npm i 软件包名
下载全局软件包 npm i 软件包名 -g
删除软件包 npm uni 软件包名
```

### Express - 框架

```
定义：Express基于 Node.js 平台，快速、开放、极简的web开发框架
概念：使用 express 本地软件包，快速搭建 Web 服务（基于 http 模块）
功能：
提供数据接口
提供网页资源等
```

### 浏览器的同源策略

```
同源策略：同源策略是一个重要的安全策略，它用于限制一个避的文档或者它加载的脚本如何能与另一个源的资源进行交互
例如，它可以防止互联网上的恶意网站在浏览器中运行 JS它能帮助阻隔恶意文档，减少可能被攻击的媒介。脚本，从第三方网络邮件服务(用户已登录) 或公司内网(因没有公共  地址而受到保护，不会被攻击者自接访问)读取数据，并将这些数据转发给攻击者。
作用：保护浏览器中网站的安全，限制 AJAX 只能向同源 URL 发起请求
源：Web 内容的源由用于访问它的 URL 的方案 (协议)口都匹配时，两个对象才具有相同的源。
主机名(域名) 和端定义。只有当协议、主机和端
同源：网页加载时所在源，和 AJAX 请求时的源（协议，域名，端口号）全部相同即为同源
```

## 跨域问题

```
跨域：从一个源的文档/脚本，加载另一个源的资源就产生了跨域
需求：在 LiveServer 的 Web 服务启动网页，用 AJAX 访问本机 Web 服务提供的省份列表接口，体验下跨域问题
```

**跨域问题 - 解决方案1 - CORS**

```
目标：前后端分离的项目，前端和后端不在一个源，还要保证数据通信
解决：采用 CORS （跨域资源共享），一种基于 HTTP 头的机制，该机制通过允许服务器标示除了它自己以外的其他源
（域、协议或端口），使得浏览器允许这些源访问加载自己的资源
步骤：
服务器端：设置 Access-Control-Allow-Origin 响应头字段，允许除了它自己以外的源来访问自己的资源
前端：正常发起 AJAX 请求，无需额外操作
```

**跨域问题 - 解决方案2 - 同源访问**

```
目标：开发环境用 cors，上线部署关闭 cors，并采用同源访问方式
做法：让后端 Web 服务既可以提供数据接口，也可以返回网页资源
好处：安全，后端的接口不允许非同源来访问
```

